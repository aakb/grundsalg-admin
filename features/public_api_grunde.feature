Feature: Public API
  In order to serve the front end
  As a client software developer
  I need to be able to retrieve "grunde" trough the API.

  Background:
    Given the following grunde exist:
      | Vej       | Husnummer | Bogstav | Salgsomraade | Annonceres | DatoAnnonce | geometry                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
      | Førstevej | 13        |         | 1            | 1            | -1 day      | POLYGON((580660.8818873378 6236228.713680544,580661.7394551445 6236232.552899082,580675.0894770599 6236298.669441251,580676.2768786384 6236304.548244638,580672.8301157227 6236310.577017498,580668.7236852633 6236311.946738696,580664.5677797381 6236313.136496524,580616.4450324264 6236308.417457071,580624.3610429505 6236285.692082755,580633.8849931125 6236258.37764253,580643.2605180771 6236231.453122939,580650.2035189744 6236230.843247077,580660.8818873378 6236228.713680544)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
      | Førstevej | 11        |         | 1            | 1            | -1 day      | POLYGON((565762.1997089473 6225265.705169221,565770.0909819386 6225260.356257977,565792.6598577769 6225287.340765359,565743.8279678557 6225324.353231578,565724.6233964902 6225304.647242676,565762.1997089473 6225265.705169221)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
      | Andenvej  | 171       | A       | 1            | 1            | -1 day      | POLYGON((577343.191172355 6231919.480812432,577376.2982372036 6231936.327383362,577413.2478654941 6231956.243329528,577343.2324015764 6232074.46926498,577325.5780489385 6232063.22155442,577291.1186656253 6232044.375390502,577274.6517145662 6232035.14726886,577315.6582982504 6231965.941355523,577343.191172355 6231919.480812432)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      | Andenvej  | 171       | C       | 1            | 1            | -1 day      | POLYGON((577413.2478654941 6231956.243329528,577416.3565487937 6231957.912989673,577479.9979750707 6231993.925659399,577409.3228436093 6232113.26136896,577408.283867228 6232112.47152973,577377.4361637164 6232095.734936415,577343.2324015764 6232074.46926498,577413.2478654941 6231956.243329528)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
      | Andenvej  | 171       | B       | 1            | 1            | -1 day      | POLYGON((561503.4602595221 6222216.785767948,561656.8824384945 6222220.055102484,561656.5690964112 6222266.055739188,561646.6081165016 6222272.61440419,561503.1799008161 6222269.555026918,561503.4602595221 6222216.785767948)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      | Tredjevej | 1         |         | 2            | 0            | -1 day      | POLYGON((569506.3489992333 6219278.243899647,569525.36391618 6219268.425898073,569567.4094762455 6219242.411193291,569623.7863136977 6219211.667451091,569641.6880416644 6219206.218560196,569660.6782210781 6219205.358735211,569661.230692646 6219205.688668055,569672.3213532242 6219212.637253691,569691.6743497871 6219225.854563345,569768.7482564222 6219279.653612704,569771.3127139983 6219281.333270814,569773.9926133945 6219282.882955381,569776.985854874 6219284.372652157,569779.6245250487 6219285.512420161,569781.4963317038 6219286.192281777,569782.5847831509 6219286.582202409,569785.5367954089 6219287.47202129,569788.6537245528 6219288.211870695,569790.6162354953 6219288.561799468,569791.6881952538 6219288.741762837,569794.755649332 6219289.101689575,569797.8973160087 6219289.291650909,569800.9812617755 6219289.291650909,569804.0487158536 6219289.11168754,569807.206874219 6219288.751760802,569809.9692320582 6219288.431825925,569812.7150982087 6219288.291854415,569815.4857018922 6219288.30185238,569818.2315680428 6219288.481815749,569821.0104175706 6219288.841742487,569823.7727754097 6219289.351638699,569825.7105488193 6219293.960700538,569813.5726660155 6219315.216374007,569807.4212661707 6219326.804015376,569802.638676479 6219328.263718258,569758.3584926092 6219304.518551518,569733.1344549076 6219292.281042428,569706.9621451119 6219282.213091729,569680.0394634852 6219274.36468925,569652.5560644466 6219268.815818706,569624.7016024145 6219265.596473994,569596.6739776522 6219264.726651044,569568.6710904229 6219266.21634782,569558.2565890769 6219267.396107684,569552.0804516992 6219268.215940809,569535.8608759688 6219271.045364888,569520.9853728588 6219274.324697389,569506.3489992333 6219278.243899647)),25832                                                                                 |
      | Tredjevej | 3         |         | 2            | 1            | -1 day      | POLYGON((561503.4602595221 6222216.785767948,561503.8807975812 6222137.012005667,561652.0173903598 6222171.245037632,561657.204026422 6222172.424797496,561657.1710430448 6222177.273810493,561657.2617473321 6222177.893684319,561656.8824384945 6222220.055102484,561503.4602595221 6222216.785767948)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      | Tredjevej | 5         |         | 2            | 1            | -1 day      | POLYGON((579454.6055711129 6229293.845252957,579493.5671854117 6229396.09444043,579467.4773340591 6229400.273589777,579452.4286682188 6229402.693097293,579437.7840487489 6229405.042619054,579423.1311834349 6229407.392140816,579408.4783181208 6229409.741662578,579399.3831518623 6229411.20136546,579395.1447878941 6229410.25155879,579392.5226094079 6229409.661678858,579381.4731780512 6229406.282366708,579357.1974124437 6229394.864690742,579377.5069269448 6229373.848968432,579387.6987904947 6229363.311113382,579392.2834799234 6229358.572077999,579397.816441446 6229352.773258332,579405.4438474198 6229344.784884342,579407.9093548644 6229342.235403282,579418.1177101028 6229331.697548232,579418.6124607606 6229331.18765202,579428.5239656045 6229320.869752198,579431.6244030598 6229317.650407487,579444.9002123765 6229303.553276917,579454.6055711129 6229293.845252957)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
      | Fjerdevej | 3         | B       | 3            | 1            | -1 day      | POLYGON((572911.5446138858 6229682.266190998,572915.5603400579 6229672.028274897,572941.9305501168 6229682.366170648,572961.9514600675 6229693.673868998,572957.2430829746 6229703.641840046,572943.7941109276 6229733.105842734,572922.8661581043 6229779.256448912,572896.454718824 6229837.064682213,572878.1984195525 6229876.786596932,572874.6939357268 6229883.095312811,572858.2269846676 6229915.128792489,572855.5965603371 6229920.24775054,572851.4489006562 6229913.649093677,572844.1513284541 6229904.141029017,572837.4309653529 6229893.743145476,572822.893541859 6229868.048375572,572812.479040513 6229854.211192091,572797.8426668876 6229837.824527549,572787.8816869779 6229828.66639166,572786.7932355308 6229827.8565565,572862.7127239646 6229663.140084062,572911.5446138858 6229682.266190998)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      | Fjerdevej | 3         | C       | 3            | 1            | +1 day      | POLYGON((572753.8510875681 6229608.681169016,572915.5603400579 6229672.028274897,572911.5446138858 6229682.266190998,572862.7127239646 6229663.140084062,572786.7932355308 6229827.8565565,572777.4836773206 6229820.967958654,572761.1733973031 6229810.170156516,572753.3810744432 6229804.651279868,572746.6524654977 6229798.89245206,572734.5228285382 6229788.504566484,572721.14806909 6229774.987317881,572711.121122426 6229761.500063173,572701.984726946 6229745.423335544,572690.1354486926 6229717.279064229,572686.5567522681 6229700.062568597,572685.5919884854 6229681.8662724,572687.6287120265 6229659.310863488,572690.9188039007 6229644.093960845,572698.6863892276 6229626.677505914,572709.6121329198 6229608.701164947,572719.8782090684 6229595.363879712,572753.8510875681 6229608.681169016)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
      | Åvej      | 7         |         | 4            | 1            | -1 day      | POLYGON((572916.731249948 6229522.018808889,572948.6014381523 6229554.712154253,572954.0766787649 6229559.951087884,572957.9357338954 6229575.607900985,572962.7100777428 6229597.943354668,572961.9597059118 6229612.270438431,572958.3645177988 6229625.937656509,572954.7116087757 6229635.315747625,572950.6134241605 6229642.584268139,572943.3983104015 6229657.631205378,572939.9020724199 6229668.359021762,572938.4672955124 6229676.167432383,572941.9305501168 6229682.366170648,572915.5603400579 6229672.028274897,572753.8510875681 6229608.681169016,572719.8782090684 6229595.363879712,572735.5865424525 6229580.456913983,572745.1682135244 6229572.498533888,572762.1051777086 6229561.50077245,572791.0151078105 6229541.504842564,572839.8882269531 6229510.051244852,572870.5545218901 6229490.775168442,572884.9847494082 6229481.227111922,572891.4577371806 6229478.217724473,572903.389473877 6229475.3583065,572916.731249948 6229522.018808889)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
      | Ældstevej | 3         |         | 4            | 1            | -1 day      | POLYGON((567690.1523179625 6218990.402488934,567691.8262243546 6218952.550193659,567801.4794618035 6218957.399206657,567801.1826114089 6218964.087845203,567862.3585302412 6218966.797293703,567871.8989720917 6218977.225171139,567871.1486002608 6218994.201715612,567864.8900044401 6218999.930549525,567820.4036744629 6218997.96095043,567820.6922790132 6218991.272311884,567805.2148292696 6218990.582452303,567805.420975377 6218985.993386394,567788.7396323661 6218985.253536988,567788.904549252 6218981.654269609,567772.7179568989 6218980.944414098,567772.9983156049 6218974.625700254,567722.8883198178 6218972.406152036,567702.6282803825 6218990.952377005,567690.1523179625 6218990.402488934)),25832                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      | Østervej  | 5         |         | 4            | 1            | -1 day      | POLYGON((580389.4699223333 6236391.920460276,580388.8267464782 6236395.079817198,580386.7240561827 6236405.407714984,580384.6296117315 6236415.735612771,580382.526921436 6236426.063510557,580380.4324769848 6236436.391408343,580378.8327831913 6236444.219814894,580378.5606703296 6236445.569540161,580381.0096860855 6236446.069438408,580379.1873544961 6236455.047610927,580377.0846642005 6236465.375508714,580374.6933693547 6236477.153111417,580352.2976562467 6236482.062112204,580341.9985967209 6236484.311654315,580331.4191784891 6236486.631182183,580309.5099701944 6236491.44020332,580306.6156788466 6236477.373066645,580304.1996464678 6236465.595463942,580302.0722186394 6236455.267566156,580299.9530366553 6236444.939668369,580297.8338546712 6236434.611770583,580295.7064268428 6236424.293870762,580293.2903944642 6236412.506270094,580290.0745151887 6236396.869452923,580292.1359762627 6236396.689489554,580313.9627261143 6236394.509933196,580316.3210375831 6236394.279980003,580324.4514400589 6236393.470144843,580332.755005265 6236392.640313752,580334.9401540034 6236392.420358523,580345.4206221037 6236391.38057017,580352.2646728695 6236390.690710588,580355.9093360483 6236390.330783851,580366.3568207715 6236389.290995496,580367.6184349487 6236389.191015847,580368.8882949704 6236389.151023987,580371.4197691692 6236389.221009742,580373.9429975238 6236389.50095276,580389.4699223333 6236391.920460276)),25832                                                                                                                                                                                                                                                                                                                                                                                                              |
      | Zebravej  | 1         |         | 4            | 1            | -1 day      | POLYGON((580292.1359762627 6236396.689489554,580290.0745151887 6236396.869452923,580284.7641914621 6236371.084701334,580279.0333296763 6236343.160385248,580279.2807050052 6236343.000417809,580279.6435221542 6236342.750468685,580280.0063393032 6236342.510517527,580280.3691564522 6236342.260568404,580280.7402194455 6236342.020617245,580281.1030365946 6236341.780666086,580281.4740995879 6236341.540714928,580281.8451625812 6236341.310761734,580282.2079797302 6236341.070810575,580282.5790427235 6236340.840857382,580282.9501057169 6236340.600906223,580283.3294145545 6236340.370953029,580283.7004775478 6236340.140999836,580284.0715405411 6236339.911046642,580284.4426035344 6236339.681093448,580284.8219123721 6236339.451140255,580285.1929753654 6236339.231185026,580290.6847076666 6236336.131815894,580296.3166193208 6236333.312389779,580302.0804644837 6236330.772906683,580307.9679973111 6236328.513366607,580314.0451845573 6236326.523771583,580320.2213219351 6236324.834115508,580326.4799177557 6236323.454396346,580336.6965188385 6236324.584166384,580358.7376606419 6236327.073659655,580379.7233343753 6236329.443177346,580400.1235531637 6236331.742709284,580400.799712396 6236336.171807753,580396.1078269916 6236359.307098632,580393.8154822773 6236370.594801052,580389.4699223333 6236391.920460276,580373.9429975238 6236389.50095276,580371.4197691692 6236389.221009742,580368.8882949704 6236389.151023987,580367.6184349487 6236389.191015847,580366.3568207715 6236389.290995496,580355.9093360483 6236390.330783851,580352.2646728695 6236390.690710588,580345.4206221037 6236391.38057017,580334.9401540034 6236392.420358523,580332.755005265 6236392.640313752,580324.4514400589 6236393.470144843,580316.3210375831 6236394.279980003,580313.9627261143 6236394.509933196,580292.1359762627 6236396.689489554)),25832 |


  @createSchema

  Scenario: Response is OK and JSON
    When I send a "GET" request to "public/api/udstykning/1/grunde"
    Then the response status code should be 200
    And the response should be in JSON

  Scenario: Grunde are filtered by Salgsomraade
    When I send a "GET" request to "public/api/udstykning/1/grunde"
    Then the JSON node "grunde" should have 5 elements

  Scenario: Grunde are filtered by AnnonceresEj
    When I send a "GET" request to "public/api/udstykning/2/grunde"
    Then the JSON node "grunde" should have 2 elements

  Scenario: Grunde are filtered by DatoAnnonce
    When I send a "GET" request to "public/api/udstykning/3/grunde"
    Then the JSON node "grunde" should have 1 elements

  Scenario: Grunde are sorted correctly by address
    When I send a "GET" request to "public/api/udstykning/1/grunde"
    Then the JSON node "grunde[0].address" should be equal to "Andenvej 171A"
    Then the JSON node "grunde[1].address" should be equal to "Andenvej 171B"
    Then the JSON node "grunde[2].address" should be equal to "Andenvej 171C"
    Then the JSON node "grunde[3].address" should be equal to "Førstevej 11"
    Then the JSON node "grunde[4].address" should be equal to "Førstevej 13"

  Scenario: Grunde with danish characters/names are sorted correctly by address
    When I send a "GET" request to "public/api/udstykning/4/grunde"
    Then the JSON node "grunde[0].address" should be equal to "Zebravej 1"
    Then the JSON node "grunde[1].address" should be equal to "Ældstevej 3"
    Then the JSON node "grunde[2].address" should be equal to "Østervej 5"
    Then the JSON node "grunde[3].address" should be equal to "Åvej 7"

  Scenario: GeoJSON is returned correctly
    When I send a "GET" request to "public/api/udstykning/1/grunde/geojson"
    Then the response status code should be 200
    Then the response should be in JSON
    Then the JSON node "type" should be equal to "FeatureCollection"
    Then the JSON node "crs.type" should be equal to "link"
    Then the JSON node "crs.properties.href" should be equal to "http://spatialreference.org/ref/epsg/25832/proj4/"
    Then the JSON node "crs.properties.type" should be equal to "proj4"
    Then the JSON node "features[0].geometry.type" should be equal to "Polygon"
    Then the JSON node "features[0].geometry.coordinates[0][0][0]" should be equal to "577343.19117235,6231919.4808124"

  @dropSchema
  Scenario: Drop schema
